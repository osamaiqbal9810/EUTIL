
let ApplicationLookupsModel = require("./../api/ApplicationLookups/ApplicationLookups.model");
let AssetModel = require("./../api/assets/assets.modal");
let AssetTypeModel = require("./../api/assetTypes/assetTypes.model");

let ServiceLocator = require("../framework/servicelocator");
import { track1Assets, track2Assets, track1GIS, track2GIS } from "./data/NHSLSEPTA";
import { guid } from "./UUID";
import { reverseLatLon } from "./latlonCorrection";
import { lampT1NHSL } from "./data/lampT1NHSL";

var lineAsset=
{
    coordinates: [ 
        [ 
            "", 
            ""
        ], 
        [ 
            "", 
            ""
        ]
    ],
    "inspectable" : false,
    "parentAsset" : null,
    "images" : [],
    "documents" : [],
    "childAsset" : [],
    "isRemoved" : false,
    "subdivision" : "Norristown",
    "unitId" : "NORRISTOWN HIGH SPEED LINE",
    "description" : "NORRISTOWN HIGH SPEED LINE",
    "end" : "13.4",
    "start" : "0",
    "assetLength" : "13.4",
    "assetType" : "line",
    "frequency" : null,
    "attributes" : {
        "geoJsonCord" : "{   \"type\": \"FeatureCollection\",   \"features\": [     {       \"type\": \"Feature\",       \"geometry\": {         \"type\": \"LineString\",         \"coordinates\": [           [             -75.25916398199536,             39.96268527583308,             0           ],           [             -75.25969185531477,             39.962725100820826,             0           ],           [             -75.25985964214016,             39.962748479197565,             0           ],           [             -75.25990775426783,             39.96275795109503,             0           ],           [             -75.2599572075041,             39.962768450875856,             0           ],           [             -75.26002728029056,             39.96278431088263,             0           ],           [             -75.2600788289152,             39.96280016093188,             0           ],           [             -75.26011763705537,             39.96281703886676,             0           ],           [             -75.26015242189561,             39.962829342869234,             0           ],           [             -75.26021671104729,             39.96284935613394,             0           ],           [             -75.26033355482298,             39.96291092323405,             0           ],           [             -75.26043564661308,             39.96297146229092,             0           ],           [             -75.26078605091351,             39.963219487718305,             0           ],           [             -75.2609788342819,             39.96335735410494,             0           ],           [             -75.2614886194342,             39.96372593155208,             0           ],           [             -75.26168182299381,             39.96386910388136,             0           ],           [             -75.26194208299893,             39.964039000869434,             0           ],           [             -75.26245631846291,             39.964326188335825,             0           ],           [             -75.26294380871354,             39.96451788764686,             0           ],           [             -75.2634822634111,             39.96465613496261,             0           ],           [             -75.26447232998908,             39.964860359997154,             0           ],           [             -75.26543705002905,             39.965077132738806,             0           ],           [             -75.26574805948786,             39.96517287808733,             0           ],           [             -75.26605102325334,             39.96528506853641,             0           ],           [             -75.26664488392413,             39.965527948720634,             0           ],           [             -75.26769223032846,             39.96597487769052,             0           ],           [             -75.26827556297792,             39.966232675055906,             0           ],           [             -75.27076744398971,             39.96725114106582,             0           ],           [             -75.27294426877575,             39.96816462288214,             0           ],           [             -75.27387444206778,             39.968555297101126,             0           ],           [             -75.27498336530118,             39.96902626953667,             0           ],           [             -75.2752997817314,             39.969178147852574,             0           ],           [             -75.27559205966952,             39.96933824784624,             0           ],           [             -75.27598891152826,             39.969579595211066,             0           ],           [             -75.27666072788872,             39.970108987454935,             0           ],           [             -75.2775317664316,             39.97093541648024,             0           ],           [             -75.27899643133566,             39.97232745395209,             0           ],           [             -75.28077123863119,             39.97400784315998,             0           ],           [             -75.2813585614548,             39.97455462291894,             0           ],           [             -75.28159720185135,             39.9747930823465,             0           ],           [             -75.28159720185135,             39.9747930823465,             0           ],           [             -75.2820295124842,             39.97520717582991,             0           ],           [             -75.28256442436293,             39.97579182434182,             0           ],           [             -75.28287648099672,             39.97621045918847,             0           ],           [             -75.28320515698016,             39.976768816423146,             0           ],           [             -75.28341356444969,             39.977182096101565,             0           ],           [             -75.28366015542474,             39.977930471952064,             0           ],           [             -75.28376774111416,             39.97850561336269,             0           ],           [             -75.28379975949184,             39.97906944684599,             0           ],           [             -75.28382923092107,             39.97988329260892,             0           ],           [             -75.28384898948292,             39.98021439368452,             0           ],           [             -75.28389020601418,             39.980549605325166,             0           ],           [             -75.28393753620765,             39.98080565553981,             0           ],           [             -75.28398852312853,             39.981015222875435,             0           ],           [             -75.28410096284603,             39.98136233117233,             0           ],           [             -75.28420691010211,             39.98161885740639,             0           ],           [             -75.28433895308035,             39.981904106976735,             0           ],           [             -75.28451254725229,             39.982187801712065,             0           ],           [             -75.28470151761303,             39.982475659244656,             0           ],           [             -75.28487519878604,             39.982716523585665,             0           ],           [             -75.28503349573089,             39.98289070854907,             0           ],           [             -75.28516258904801,             39.98305802668113,             0           ],           [             -75.28553282450468,             39.98347608523883,             0           ],           [             -75.28573291011696,             39.983712096432285,             0           ],           [             -75.2859544548578,             39.98394810724382,             0           ],           [             -75.28638851498044,             39.98434008494561,             0           ],           [             -75.28683064467884,             39.984664164203615,             0           ],           [             -75.28729238566996,             39.98495887761773,             0           ],           [             -75.28794940237788,             39.98527875945711,             0           ],           [             -75.28825484592227,             39.98541231198329,             0           ],           [             -75.28862466376245,             39.98553764300881,             0           ],           [             -75.2891194715084,             39.98569132537471,             0           ],           [             -75.2898539529337,             39.985886163103956,             0           ],           [             -75.29043826403199,             39.98604741643236,             0           ],           [             -75.29089107924779,             39.98621321630122,             0           ],           [             -75.29105541270337,             39.98627954050471,             0           ],           [             -75.29126266198693,             39.98639107669469,             0           ],           [             -75.2917043782104,             39.98666499208113,             0           ],           [             -75.29182572933996,             39.98675570769924,             0           ],           [             -75.29196290461766,             39.98685828983169,             0           ],           [             -75.29210544480065,             39.98699375317939,             0           ],           [             -75.29229840026812,             39.98719537309147,             0           ],           [             -75.29248331027185,             39.98742165366069,             0           ],           [             -75.29274675429309,             39.98778484307288,             0           ],           [             -75.29293942173473,             39.98803548616183,             0           ],           [             -75.29308086401886,             39.98822186201881,             0           ],           [             -75.29336078541905,             39.9885984277739,             0           ],           [             -75.29349276862473,             39.98876036845669,             0           ],           [             -75.29361402361752,             39.98893463917805,             0           ],           [             -75.29377670032858,             39.98914141104106,             0           ],           [             -75.2939340136191,             39.98936051279164,             0           ],           [             -75.29414462170377,             39.989626516329956,             0           ],           [             -75.29437132479813,             39.989908959483834,             0           ],           [             -75.29456880674263,             39.99015288263799,             0           ],           [             -75.29477165453477,             39.99039680544786,             0           ],           [             -75.29496511271884,             39.9906171533335,             0           ],           [             -75.2951853943029,             39.99082928095662,             0           ],           [             -75.29540669925927,             39.99107027238389,             0           ],           [             -75.29564409907437,             39.9913071534391,             0           ],           [             -75.29586157319113,             39.99150066974429,             0           ],           [             -75.29608441307943,             39.99172706478168,             0           ],           [             -75.29632616178122,             39.99194182667015,             0           ],           [             -75.29657864087307,             39.99215658803386,             0           ],           [             -75.29705841592744,             39.99254911587311,             0           ],           [             -75.29739221833961,             39.99282616956429,             0           ],           [             -75.29788169515155,             39.99316340153668,             0           ],           [             -75.29825068989248,             39.99342566795461,             0           ],           [             -75.29860910575525,             39.99363936251865,             0           ],           [             -75.29934367754208,             39.994082393707366,             0           ],           [             -75.29985732056844,             39.99439688431848,             0           ],           [             -75.30068700010395,             39.99483430880676,             0           ],           [             -75.30132938916302,             39.99515085079269,             0           ],           [             -75.30209784204578,             39.99551259750579,             0           ],           [             -75.30272266009007,             39.995811848736544,             0           ],           [             -75.30316656568203,             39.996021536102006,             0           ],           [             -75.30358633139286,             39.996216839189124,             0           ],           [             -75.3042934092681,             39.996545334557695,             0           ],           [             -75.30501894680663,             39.996890635607265,             0           ],           [             -75.30579008189841,             39.9972503183307,             0           ],           [             -75.30663363663359,             39.99765314917383,             0           ],           [             -75.30738867847128,             39.998031320638546,             0           ],           [             -75.30810885159178,             39.9984998984726,             0           ],           [             -75.30873125422386,             39.99903327918866,             0           ],           [             -75.30935357363182,             39.99976030604653,             0           ],           [             -75.30949975402314,             39.99998025474834,             0           ],           [             -75.30949975402314,             39.99998025474834,             0           ],           [             -75.3097862716254,             40.00049826564078,             0           ],           [             -75.31002901154125,             40.00098326384223,             0           ],           [             -75.31028248029315,             40.00147647718675,             0           ],           [             -75.31051180916393,             40.00189982944348,             0           ],           [             -75.31072504478061,             40.00231085134571,             0           ],           [             -75.31094096260631,             40.00272392538303,             0           ],           [             -75.31118906694019,             40.00318425263388,             0           ],           [             -75.31143180685604,             40.0036158126321,             0           ],           [             -75.31169332223499,             40.00407818843822,             0           ],           [             -75.31190119343364,             40.00442345139604,             0           ],           [             -75.31213588672244,             40.00484473083439,             0           ],           [             -75.3123625333842,             40.00520848072932,             0           ],           [             -75.31257308679187,             40.00557428320978,             0           ],           [             -75.31279168682659,             40.005950356292196,             0           ],           [             -75.31301833348834,             40.006301773287305,             0           ],           [             -75.31323156910503,             40.006649079491126,             0           ],           [             -75.31342602925861,             40.00699638392802,             0           ],           [             -75.31363390045726,             40.007343686598,             0           ],           [             -75.31385786491,             40.0077135865558,             0           ],           [             -75.31407646494472,             40.00807115781985,             0           ],           [             -75.31430311160648,             40.008445162710196,             0           ],           [             -75.31467996197307,             40.009061587378156,             0           ],           [             -75.3150085325774,             40.00959788483018,             0           ],           [             -75.31531296330058,             40.01002734989586,             0           ],           [             -75.31536392527187,             40.01010541665398,             0           ],           [             -75.31572200017536,             40.01054309602297,             0           ],           [             -75.31601033764446,             40.01087189137359,             0           ],           [             -75.31615115361774,             40.011034282244815,             0           ],           [             -75.31654409723842,             40.01140621655195,             0           ],           [             -75.31686998563373,             40.01171857303767,             0           ],           [             -75.31715832310283,             40.01197956984356,             0           ],           [             -75.31752444463336,             40.01226727184434,             0           ],           [             -75.31791738825405,             40.01257140713814,             0           ],           [             -75.31832642512882,             40.01287759538051,             0           ],           [             -75.3187005932864,             40.013165293595854,             0           ],           [             -75.31914986329639,             40.013496130600075,             0           ],           [             -75.31956426458919,             40.01379820614196,             0           ],           [             -75.31994111495578,             40.014100280346845,             0           ],           [             -75.32037429171169,             40.01443111281877,             0           ],           [             -75.3207913752135,             40.01480097436957,             0           ],           [             -75.32120845871532,             40.01519959319612,             0           ],           [             -75.32153166490161,             40.01556739635941,             0           ],           [             -75.32168589191997,             40.01577291462122,             0           ],           [             -75.32168589191997,             40.01577291462122,             0           ],           [             -75.3220144625243,             40.01619412401771,             0           ],           [             -75.32233230429256,             40.016617385005645,             0           ],           [             -75.32275207000339,             40.01717005648801,             0           ],           [             -75.32285801725948,             40.017299565651456,             0           ],           [             -75.32319195228183,             40.01778444449269,             0           ],           [             -75.3233837302264,             40.01802487661665,             0           ],           [             -75.3233837302264,             40.01802487661665,             0           ],           [             -75.3233837302264,             40.01802487661665,             0           ],           [             -75.32362915235126,             40.01830228243197,             0           ],           [             -75.32373174661518,             40.01843482246335,             0           ],           [             -75.32387993889415,             40.018569416458185,             0           ],           [             -75.32430506902301,             40.018865307173996,             0           ],           [             -75.32464973288143,             40.01904411197325,             0           ],           [             -75.32508022742832,             40.01923113275451,             0           ],           [             -75.32563142138088,             40.019379124981285,             0           ],           [             -75.32611287789905,             40.019475764277765,             0           ],           [             -75.32665602522457,             40.019537483690414,             0           ],           [             -75.32719380813205,             40.01960125714864,             0           ],           [             -75.32757870512569,             40.01966913874604,             0           ],           [             -75.32778322337822,             40.01972875589528,             0           ],           [             -75.32798774200046,             40.019792480879964,             0           ],           [             -75.3281942718582,             40.019860827803335,             0           ],           [             -75.32839811997974,             40.01994971529884,             0           ],           [             -75.32872266727054,             40.02011311161355,             0           ],           [             -75.32889768113921,             40.02020918826112,             0           ],           [             -75.329075377756,             40.02032169730494,             0           ],           [             -75.32940394836032,             40.020585742317955,             0           ],           [             -75.32967619257533,             40.020836434893326,             0           ],           [             -75.33006913619602,             40.02121242388747,             0           ],           [             -75.3302823718127,             40.02140970896114,             0           ],           [             -75.33036750400498,             40.021489827429306,             0           ],           [             -75.33066053533986,             40.02176717101679,             0           ],           [             -75.33090368699925,             40.02201052661527,             0           ],           [             -75.33137845479195,             40.02246503998655,             0           ],           [             -75.33185408008933,             40.022925933514344,             0           ],           [             -75.33236272304703,             40.023405912807675,             0           ],           [             -75.332581993634,             40.02363395310513,             0           ],           [             -75.33286635560279,             40.023941620665795,             0           ],           [             -75.33319257912888,             40.02433953847873,             0           ],           [             -75.33360697848832,             40.02486847301717,             0           ],           [             -75.33424831671465,             40.02563632460166,             0           ],           [             -75.3347866967701,             40.026217031743954,             0           ],           [             -75.33572346913138,             40.02721790978404,             0           ],           [             -75.33631073588236,             40.02785691132151,             0           ],           [             -75.33640662485465,             40.02796067894739,             0           ],           [             -75.3370191996907,             40.02862662737491,             0           ],           [             -75.33772751578499,             40.029397533764616,             0           ],           [             -75.33828438577939,             40.02999160660396,             0           ],           [             -75.3388874938255,             40.03063983754743,             0           ],           [             -75.33982635130894,             40.031664351280526,             0           ],           [             -75.34081476896222,             40.03272541612137,             0           ],           [             -75.34101526408608,             40.03291851236773,             0           ],           [             -75.3412626978677,             40.03313214501034,             0           ],           [             -75.34172592663339,             40.03342918002362,             0           ],           [             -75.34217923888104,             40.03364668636843,             0           ],           [             -75.34285626851528,             40.033864869644404,             0           ],           [             -75.34371986855263,             40.03401894299748,             0           ],           [             -75.34401826430553,             40.034054930298254,             0           ],           [             -75.34401826430553,             40.034054930298254,             0           ],           [             -75.34542205459564,             40.03423547515918,             0           ],           [             -75.34658768815086,             40.03438201685341,             0           ],           [             -75.34754561601312,             40.034505284255566,             0           ],           [             -75.34865783599264,             40.03464806109694,             0           ],           [             -75.34927472519036,             40.03472150464204,             0           ],           [             -75.34989161580961,             40.034805213146164,             0           ],           [             -75.35014703769275,             40.034851384956504,             0           ],           [             -75.35040245993707,             40.034901663490395,             0           ],           [             -75.35065520042036,             40.03496939745148,             0           ],           [             -75.35087575491542,             40.03505150640105,             0           ],           [             -75.35113630389537,             40.035156124808026,             0           ],           [             -75.35136797928021,             40.035278340001454,             0           ],           [             -75.35156746899452,             40.035421091087414,             0           ],           [             -75.35179042706278,             40.03560748128185,             0           ],           [             -75.35196778868999,             40.035800031990085,             0           ],           [             -75.35209501922799,             40.03599461577446,             0           ],           [             -75.35219542833909,             40.036197413878384,             0           ],           [             -75.35231679829701,             40.036509608750826,             0           ],           [             -75.35245694371804,             40.03709903531928,             0           ],           [             -75.35258367809399,             40.03765152052808,             0           ],           [             -75.35269771541527,             40.03817775758085,             0           ],           [             -75.35279145363836,             40.038660909301115,             0           ],           [             -75.35289538923769,             40.0390809025101,             0           ],           [             -75.35298054937391,             40.039358174580016,             0           ],           [             -75.35306658325953,             40.0398021364755,             0           ],           [             -75.35312760351462,             40.04009480674672,             0           ],           [             -75.35321544585986,             40.0403422992858,             0           ],           [             -75.3532670783834,             40.040638047440524,             0           ],           [             -75.35333882747454,             40.040923527016446,             0           ],           [             -75.35340118883414,             40.04121413902379,             0           ],           [             -75.35353999315066,             40.041789150895596,             0           ],           [             -75.35356748579306,             40.04191753848236,             0           ],           [             -75.35359028456969,             40.042063428069476,             0           ],           [             -75.35364225225675,             40.04226153131671,             0           ],           [             -75.35367142139239,             40.04248222209739,             0           ],           [             -75.35368836617033,             40.04267443966527,             0           ],           [             -75.3536865355187,             40.04278452094302,             0           ],           [             -75.35367779300009,             40.042986221775095,             0           ],           [             -75.35364759269589,             40.04318176241207,             0           ],           [             -75.3535627682378,             40.04347798698643,             0           ],           [             -75.35345380309457,             40.04374751750595,             0           ],           [             -75.35335221475657,             40.04395441847038,             0           ],           [             -75.35323185029858,             40.04415105248822,             0           ],           [             -75.35309255555393,             40.04435191132948,             0           ],           [             -75.35292912004991,             40.04454660990534,             0           ],           [             -75.35266592922801,             40.044799195466254,             0           ],           [             -75.35239468990369,             40.04502508695654,             0           ],           [             -75.35204499802035,             40.04524173786809,             0           ],           [             -75.35166043518586,             40.04543990765604,             0           ],           [             -75.35058553992315,             40.045896818690586,             0           ],           [             -75.35028949169981,             40.04603390121072,             0           ],           [             -75.35002562879129,             40.04618740949959,             0           ],           [             -75.34955327623669,             40.046514306449936,             0           ],           [             -75.34926331054953,             40.0467857632839,             0           ],           [             -75.34909734932012,             40.04697674221081,             0           ],           [             -75.34894479822901,             40.04717388075072,             0           ],           [             -75.34844760344578,             40.048080683603125,             0           ],           [             -75.34787257381805,             40.04918359515804,             0           ],           [             -75.34744072716813,             40.049976705279974,             0           ],           [             -75.34730192285161,             40.05017908823202,             0           ],           [             -75.34709472220521,             40.05045220882358,             0           ],           [             -75.34696262341123,             40.05060624469733,             0           ],           [             -75.34669071549098,             40.050891658272135,             0           ],           [             -75.34643221657853,             40.05112984857445,             0           ],           [             -75.34608083041849,             40.05140951005963,             0           ],           [             -75.34571334813057,             40.05167479842877,             0           ],           [             -75.34527760626258,             40.05193556848333,             0           ],           [             -75.3448177212756,             40.05216759302345,             0           ],           [             -75.34385335546517,             40.05262847958804,             0           ],           [             -75.34274826810832,             40.05312845737911,             0           ],           [             -75.3416517437517,             40.05362817679861,             0           ],           [             -75.34127130149079,             40.0538246913499,             0           ],           [             -75.3409988322914,             40.053984571801195,             0           ],           [             -75.34076123056656,             40.05415677008842,             0           ],           [             -75.34045271364414,             40.05441491102343,             0           ],           [             -75.34019783866626,             40.05469768790981,             0           ],           [             -75.33997969779472,             40.05499357992491,             0           ],           [             -75.33981788163987,             40.055297683771705,             0           ],           [             -75.3397261034047,             40.055489927842714,             0           ],           [             -75.33966919346057,             40.05568833092786,             0           ],           [             -75.33957683027427,             40.0560871900173,             0           ],           [             -75.33953176552347,             40.056705606766045,             0           ],           [             -75.33949622625403,             40.057324856969394,             0           ],           [             -75.33948669466787,             40.05792326726624,             0           ],           [             -75.339465907548,             40.058303109572,             0           ],           [             -75.3394571903687,             40.05837706333799,             0           ],           [             -75.3394484731894,             40.05865900299933,             0           ],           [             -75.339420980547,             40.05911993124593,             0           ],           [             -75.33940723426849,             40.05946932182864,             0           ],           [             -75.33940421674066,             40.05981460660926,             0           ],           [             -75.3393951642816,             40.059958821739976,             0           ],           [             -75.33940756950193,             40.06011124841426,             0           ],           [             -75.3394091391931,             40.0602355440674,             0           ],           [             -75.33943753102955,             40.06036189259621,             0           ],           [             -75.33948480473225,             40.06061998260594,             0           ],           [             -75.33956158319648,             40.06086986111816,             0           ],           [             -75.33986534336742,             40.06147857906208,             0           ],           [             -75.34035449719977,             40.06231735551533,             0           ],           [             -75.34082872741601,             40.06312766487241,             0           ],           [             -75.34154404803013,             40.064349419522,             0           ],           [             -75.34196917628526,             40.06509228220561,             0           ],           [             -75.3420837212874,             40.06532732639496,             0           ],           [             -75.34213026522855,             40.06544998026669,             0           ],           [             -75.34216876269704,             40.065574686843384,             0           ],           [             -75.34222073407045,             40.065745974499606,             0           ],           [             -75.34226197684632,             40.06592342027184,             0           ],           [             -75.34230154750901,             40.06628652260538,             0           ],           [             -75.34227836244713,             40.06668293782618,             0           ],           [             -75.34222773604358,             40.0669492793215,             0           ],           [             -75.34217694165545,             40.067095792448676,             0           ],           [             -75.34213419371258,             40.067229989515305,             0           ],           [             -75.34197393172394,             40.06765391201536,             0           ],           [             -75.34179187723782,             40.06812752032366,             0           ],           [             -75.34174778830555,             40.06827349467064,             0           ],           [             -75.34170235806118,             40.06844717957876,             0           ],           [             -75.34168727072728,             40.068594800563034,             0           ],           [             -75.34166564540823,             40.06887746542788,             0           ],           [             -75.34167084210526,             40.06920939309677,             0           ],           [             -75.3417603320645,             40.0696198946369,             0           ],           [             -75.34182269342409,             40.06985599074412,             0           ],           [             -75.34201514192091,             40.07025013455807,             0           ],           [             -75.34228092117229,             40.070744505343924,             0           ],           [             -75.34233255369583,             40.07083281351521,             0           ],           [             -75.34255048317829,             40.07123105676937,             0           ],           [             -75.34312997486836,             40.07229712957167,             0           ],           [             -75.34347799148804,             40.07295090030558,             0           ],           [             -75.34397352960355,             40.073841725187606,             0           ],           [             -75.34436546468714,             40.07455543045182,             0           ],           [             -75.3447097910655,             40.075184998089654,             0           ],           [             -75.3450640960582,             40.0758276793624,             0           ],           [             -75.34542049693607,             40.076430899461045,             0           ],           [             -75.34578326570534,             40.076963540581225,             0           ],           [             -75.3463315788099,             40.07772364575255,             0           ],           [             -75.34679276482285,             40.07835362123872,             0           ],           [             -75.34739961461247,             40.07919101550313,             0           ],           [             -75.34812671570853,             40.080171402677756,             0           ],           [             -75.3487241777666,             40.08098927819372,             0           ],           [             -75.34879324464873,             40.0810796253305,             0           ],           [             -75.34886264667148,             40.08115814784075,             0           ],           [             -75.34895082442836,             40.081267453998706,             0           ],           [             -75.349021232415,             40.08136087912794,             0           ],           [             -75.35017448158538,             40.08297068896569,             0           ],           [             -75.35070483128061,             40.08369660731935,             0           ],           [             -75.35128460162798,             40.084473859704595,             0           ],           [             -75.35172732923172,             40.085085521180886,             0           ],           [             -75.35212630782269,             40.085691970617006,             0           ],           [             -75.35246563509395,             40.086335452575206,             0           ],           [             -75.35271333905018,             40.08693759497591,             0           ],           [             -75.35279179366387,             40.087249557437715,             0           ],           [             -75.35302030556204,             40.0883118712401,             0           ],           [             -75.35303438715937,             40.088477107667664,             0           ],           [             -75.35304042212965,             40.089089682913624,             0           ],           [             -75.3527696939675,             40.09199809299335,             0           ],           [             -75.35274488353411,             40.09228730383522,             0           ],           [             -75.3526975866036,             40.092649035574595,             0           ],           [             -75.35266607064767,             40.092969179425126,             0           ],           [             -75.35256308140862,             40.09391623061951,             0           ],           [             -75.35247215232789,             40.09488472207509,             0           ],           [             -75.35240523325257,             40.095445150059284,             0           ],           [             -75.35235699125428,             40.0960309095865,             0           ],           [             -75.35230133541722,             40.09661619176956,             0           ],           [             -75.35221936556883,             40.09732145352826,             0           ],           [             -75.35219085024158,             40.09764370635661,             0           ],           [             -75.35216501689297,             40.097898251407535,             0           ],           [             -75.35210265553337,             40.09850766427429,             0           ],           [             -75.35207248068195,             40.09877558019011,             0           ],           [             -75.35201950705391,             40.09923213355497,             0           ],           [             -75.35199671510281,             40.09940320816327,             0           ],           [             -75.35190452659634,             40.09980153127135,             0           ],           [             -75.35186613791507,             40.099961624962226,             0           ],           [             -75.35179019804724,             40.10011146022347,             0           ],           [             -75.35163027072457,             40.10040702728308,             0           ],           [             -75.35149479226789,             40.100618737365906,             0           ],           [             -75.35134321968553,             40.1008201889691,             0           ],           [             -75.35108400665922,             40.10110250845467,             0           ],           [             -75.350808698185,             40.10137867238839,             0           ],           [             -75.35058003986649,             40.10157772902041,             0           ],           [             -75.35043955945537,             40.101713673466506,             0           ],           [             -75.35029371405415,             40.10184961773632,             0           ],           [             -75.34988826746599,             40.10224676746988,             0           ],           [             -75.34973789762955,             40.1024114937676,             0           ],           [             -75.34959289149151,             40.10257827148407,             0           ],           [             -75.34936725034208,             40.102928239325394,             0           ],           [             -75.34901552938652,             40.10351188833716,             0           ],           [             -75.34861670890882,             40.10417833162525,             0           ],           [             -75.34836958822717,             40.10460505344613,             0           ],           [             -75.34817879166337,             40.104884063879304,             0           ],           [             -75.34793404009076,             40.10531185499681,             0           ],           [             -75.34757828237923,             40.105930948676374,             0           ],           [             -75.34727385165604,             40.10645827835481,             0           ],           [             -75.34709548475655,             40.10692405986499,             0           ],           [             -75.34693857552918,             40.10761754944623,             0           ],           [             -75.34683799269112,             40.108231026200905,             0           ],           [             -75.34673204543503,             40.10899835317567,             0           ],           [             -75.34655636074456,             40.11026415611992,             0           ],           [             -75.34641286256226,             40.111335058748594,             0           ],           [             -75.3463310551873,             40.1117105485842,             0           ],           [             -75.34624388339432,             40.112047061358346,             0           ],           [             -75.34613056006344,             40.11227172814176,             0           ],           [             -75.34590592505845,             40.112583574471365,             0           ],           [             -75.3457979661456,             40.11270259782064,             0           ],           [             -75.34558808329018,             40.112987775443685,             0           ],           [             -75.34524914134738,             40.113517053609534,             0           ]         ]       },       \"properties\": {         \"name\": \"wd\",         \"styleUrl\": \"#msn_ylw-pushpin\",         \"styleHash\": \"-2aaa8978\",         \"styleMapHash\": {           \"normal\": \"#sn_ylw-pushpin\",           \"highlight\": \"#sh_ylw-pushpin\"         },         \"stroke\": \"#00ff7f\",         \"stroke-opacity\": 1       }     }   ] }",
   },
    "systemAttributes" : {
        "tooltipText" : "NORRISTOWN HIGH SPEED LINE",
        "stroke" : "purple",
        "strokeWidth" : "5",
        "tension" : "0.1",
        "points" : "[   {     \"x\": 206,     \"y\": 457   },   {     \"x\": 182,     \"y\": 432   },   {     \"x\": 127,     \"y\": 375   },   {     \"x\": 127,     \"y\": 365   },   {     \"x\": 200,     \"y\": 286   },   {     \"x\": 234,     \"y\": 250   } ]"
    }
}


export function lampNHSLAssets()
{
    addLampAsset(lineAsset.unitId, lineAsset, (err, obj)=>{
      let lineId=obj._id.toString();
      // track 1
      AssetModel.findOne({unitId:'track1'})
      .then(function(track1){
        if(track1)
        {
            for(const asset of track1Assets)
            {
                let newAsset = {
                  inspectable:"false",
                  parentAsset:track1.id,
                  images:[],
                  documents:[],
                  childAsset:[],
                  isRemoved:false,
                  unitId:asset.unitId,
                  description: asset.description,
                  start: asset.start,
                  end: asset.end,
                  assetLength: asset.end-asset.start,
                  assetType: asset.assetType,
                  frequency: "",
                  attributes:{},
                  name: asset.description,
                  coordinates:asset.coordinates,
                  lineId: lineId
                };

                addLampAsset(asset.unitId, newAsset);
            }
        }
        else // add track 1
        {


        }
      });
    // track 2
    AssetModel.findOne({unitId:'track2'})
      .then(function(track2){
      if(track2)
      {
            for(const asset of track2Assets)
            {
                let newAsset = {
                  inspectable:"false",
                  parentAsset:track2.id,
                  images:[],
                  documents:[],
                  childAsset:[],
                  isRemoved:false,
                  unitId:asset.unitId,
                  description: asset.description,
                  start: asset.start,
                  end: asset.end,
                  assetLength: asset.end-asset.start,
                  assetType: asset.assetType,
                  frequency: "",
                  attributes:{},
                  name: asset.description,
                  coordinates:asset.coordinates,
                  lineId: lineId
                };

              addLampAsset(asset.unitId, newAsset);
            }
      }
      });
  });
   

   addLampAssetTypes();
}
function addLampAsset(unitId, newAst, createCallback=(err, obj)=>{})
{
    AssetModel.findOne({unitId: unitId}, function(err, ast){
      if(!ast)
      {
        console.log('adding asset', unitId);
        AssetModel.create(newAst, createCallback);
      }
      });
}
function addAssetType(name, newAt)
{
    AssetTypeModel.findOne({assetType:name}, function(err, attype){
      if(!attype)
      {
        console.log('adding assettype', name);
        AssetTypeModel.create(newAt);
      }
    });
    
}
function addLampAssetTypes()
{
  let possibleAssetTypes = ["Stone Xing", "speed change", "Gas Pipeline", "Platform", "Switch"];
  //let LampAttributes={'Stone Xing':[],'speed change':[], 'Gas Pipeline':[], 'Norristown Station': [], 'Platform':[], 'Switch':[]};
  let count=0;
  for(const asttype of possibleAssetTypes)
  {
    let newAt = {
                assetType: asttype,
                lampAttributes:[],//LampAttributes[asttype] != undefined ? LampAttributes[asttype] : [],
                timpsAttributes: { code: '22'+count++, description: asttype},
                inspectionInstructions: {},
                inspectionForms: {},
                defectCodes: []
              };
              
              addAssetType(asttype, newAt);
  }



}

export async function trackAssetPopulateNSHL() {
  //// ADD SUBDIVISION
  let Track = ServiceLocator.resolve("TrackModel");
  let subdiv = "Norristown";
  try {
    let subDivExist = await ApplicationLookupsModel.findOne({ description: subdiv, listName: "Subdivision" }).exec();
    if (!subDivExist) {
      try {
        let subDivCreate = await ApplicationLookupsModel.create({
          tenantId: "ps19",
          listName: "Subdivision",
          code: "septa-norristown",
          description: "Norristown",
          createdAt: new Date(),
          updateAt: new Date(),
        });
        if (subDivCreate) {
          console.log(" Subdivion " + subdiv + " Created");
        }
      } catch (error) {
        console.log("ERROR CREATING 'Norristown' SUBDIVISION : " + error);
      }
    }
  } catch (e) {
    console.log("ERROR FINDING 'Norristown' SUBDVISION : " + e);
  }

  //// ADD ASSETTYPES
  // let possibleAssetTypes = ["Stone Xing", "speed change", "Gas Pipeline", "Norristown Station", "Platform", "Switch"];
  // let count = 1;
  // for (let index in possibleAssetTypes) {
  //   let assetType = possibleAssetTypes[index];
  //   try {
  //     let result = await ApplicationLookupsModel.findOne({ description: assetType, listName: "assetType" }).exec();
  //     if (!result) {
  //       try {
  //         let createdAssetType = await ApplicationLookupsModel.create({
  //           tenantId: "ps19",
  //           listName: "assetType",
  //           code: "ast-csx-1050" + "00" + index,
  //           description: assetType,
  //           opt1: opt1,
  //           createdAt: "2019-01-25 4:34:00.000Z",
  //           updateAt: "2019-01-25 4:34:00.000Z",
  //         });
  //         if (createdAssetType) {
  //           console.log("AssetType Created : " + assetType);
  //         }
  //       } catch (err) {
  //         console.log("Error Creating AssetType :  " + assetType);
  //         console.log(err);
  //       }
  //     } else {
  //       // console.log("AssetType Already Exists : " + assetType);
  //     }
  //   } catch (err) {
  //     console.log("Error Finding AssetType : " + assetType);
  //     console.log(err);
  //   }
  // }

  /// FIRST TRACK
  try {
    let templateQuery = Track.findOne({ trackId: "SEPTA-NT-01" });
    let track = await templateQuery.exec();
    if (track) {
      createAssets(track, track1GIS);
    } else {
      let track = {
        units: [],
        coordinates: [],
        isRemoved: false,
        subdivision: "Norristown",
        trackType: "Light Rail",
        trackId: "SEPTA-NT-01",
        weight: "",
        end: "13.32",
        start: "0",
        assetGroupLength: "13.32",
        trafficType: "Passenger",
        class: "5",
      };
      try {
        let createdTrack = await Track.create(track);
        createAssets(createdTrack, track1GIS);
      } catch (err) {
        console.log("Error at Creating Track And Updating it");
        console.log(err);
      }
    }
  } catch (err) {
    console.log("Error at Finding Track");
    console.log(err);
  }
  /// SECOND TRACK
  try {
    let templateQuery = Track.findOne({ trackId: "SEPTA-NT-02" });
    let track = await templateQuery.exec();
    if (track) {
      createAssets(track, track2GIS);
    } else {
      let track = {
        units: [],
        coordinates: [],

        isRemoved: false,
        subdivision: "Norristown",
        trackType: "Light Rail",
        trackId: "SEPTA-NT-02",
        weight: "",
        end: "13.32",
        start: "0",
        assetGroupLength: "13.32",
        trafficType: "Passenger",
        class: "5",
      };
      try {
        let createdTrack = await Track.create(track);
        createAssets(createdTrack, track2GIS);
      } catch (err) {
        console.log("Error at Creating Track And Updating it");
        console.log(err);
      }
    }
  } catch (err) {
    console.log("Error at Finding Track");
    console.log(err);
  }

  /// THIRD TRACK
  try {
    let templateQuery = Track.findOne({ trackId: "SEPTA-NT-03" });
    let track = await templateQuery.exec();
    if (track) {
      createAssets(track);
    } else {
      let track = {
        units: [],
        coordinates: [],

        isRemoved: false,
        subdivision: "Norristown",
        trackType: "Light Rail",
        trackId: "SEPTA-NT-03",
        weight: "",
        end: "13.32",
        start: "0",
        assetGroupLength: "13.32",
        trafficType: "Passenger",
        class: "5",
      };
      try {
        let createdTrack = await Track.create(track);
        createAssets(createdTrack);
      } catch (err) {
        console.log("Error at Creating Track And Updating it");
        console.log(err);
      }
    }
  } catch (err) {
    console.log("Error at Finding Track");
    console.log(err);
  }
}

async function createAssets(track, trackGis) {
  let units = [];
  if (track.trackId == "SEPTA-NT-01") {
    units = track1Assets;
  } else if (track.trackId == "SEPTA-NT-02") {
    units = track2Assets;
  } else if (track.trackId == "SEPTA-NT-03") {
    units.push({
      assetType: "Switch",
      end: "0",
      start: "0",
      assetLength: "0",
      pastIssue: "",
      lastInspection: "",
      nextInspection: "",
      lonStart: "",
      lonEnd: "",
      latStart: "",
      latEnd: "",
      unitId: "8N switch-0",
      coordinates: [["39.962732", "-75.259689"], ["", ""]],
      id: guid(),
      createdAt: new Date(),
      updatedAt: new Date(),
    });
  }
  if (track.units.length < 1) {
    let coord = [];
    if (trackGis) {
      coord = reverseLatLon(trackGis);
    }
    track.units = units;
    track.units.unshift({
      assetType: "Rail",
      end: track.end,
      start: track.start,
      assetLength: track.assetGroupLength,
      pastIssue: "",
      lastInspection: "",
      nextInspection: "",
      unitId: "Rail-Track-01",
      coordinates: coord,
      id: guid(),
      createdAt: new Date(),
      updatedAt: new Date(),
    });
    track.markModified("units");
    try {
      let result = await track.save();
    } catch (err) {
      console.log("Error at Saving Track");
      console.log(err);
    }
  }
}
export function addLampAssetsForNHSLT1()
{
  AssetModel.findOne({},function(err,asset){
    if(!asset)
    {
      let idMap=new Map();
      let count=0;
      for(var lt1asset of lampT1NHSL)
      {
        //idMap.set(lt1asset.id, lt1asset.unitId);
        //console.log('pair ',lt1asset.id,'-',lt1asset.unitId);
        // if(lt1asset.parentAsset)
        //  {
        //     //console.log('b:',lt1asset.parentAsset);
        //     //lt1asset.parentAsset=idMap.get(lt1asset.parentAsset);
        //     //console.log('a:', lt1asset.parentAsset);
        //  }
         if(typeof lt1asset.attributes === 'string')
         {
           try{
                lt1asset.attributes = JSON.parse(lt1asset.attributes);
           }
           catch(er)
           {
             console.log(er);
           }
         }

          count++;
      }
      for(var lt1asset of lampT1NHSL)
      {
          AssetModel.create(lt1asset, (err, lta)=>{
            idMap.set(lta.unitId, lta._id.toHexString());
            //console.log(lta._id.toHexString());
            if(--count==0)
            {
              AssetModel.find({},function(err, assets){
                assets.forEach((asset)=>{
                  if(asset.parentAsset)
                  {
                    asset.parentAsset=idMap.get(asset.parentAsset);
                    asset.save();
                  }
                });
              });
            }
          });
      }
    }
  });
}

const opt1 =
  '{      "instructions":"[1] Non-class-specific defects found during an inspection by a qualified railroad inspector and not immediately repaired must be noted on the track inspection form. If not immediately repaired, remedial action shall be taken by an individual qualified under §213.7 \\n(a). The 30-day period represents the maximum duration that FRA permits any non-class-specific defect(s) to remain in the track. \\nFurthermore, it is not intended to create a 30-day timeline for all types of defects as immediate repair or a more restrictive appropriate action may be required at the time of the defect(s) discovery.\\n\\n [2] While Part 213 does not require the railroad to take the track out of service, due to the severity of these defects, FRA recommends that railroads take the track out of service. \\nAt a minimum, however, the railroad should invoke §213.9(b).\\n\\n [3] This class specific defect requires remedial action 213.9(b).",    "name":"FRA 213.233 Track Inspection",    "fields":[         {            "title":"Horizontal Split Head",          "data":[               {                  "id":"row1",                "elements":[                     {                        "name":"cbFirst",                      "tag":"cb-q1",                      "type":"BOOLEAN_CHECKBOX",                      "defaultValue":false                   },                   {                        "name":"tvFirst",                      "type":"STRING",                      "description":"Verify horizontal split heads?",                      "minCharacters":10,                      "maxCharacters":100                   },                   {                        "name":"swFirst",                      "tag":"sw-q1",                      "type":"BOOLEAN_SWITCH",                      "defaultValue":false                   }                ]             }          ]       },       {            "title":"Vertical Split Head",          "data":[               {                  "id":"row1",                "elements":[                     {                        "name":"cbFirst",                      "tag":"cb-q5",                      "type":"BOOLEAN_CHECKBOX",                      "defaultValue":false                   },                   {                        "name":"tvFirst",                      "type":"STRING",                      "description":"Verify vertical split heads?",                      "minCharacters":10,                      "maxCharacters":100                   },                   {                        "name":"swFirst",                      "tag":"sw-q5",                      "type":"BOOLEAN_SWITCH",                      "defaultValue":false                   }                ]             }          ]       },       {            "title":"Engine Burn",          "data":[               {                  "id":"row1",                "elements":[                     {                        "name":"cbFirst",                      "tag":"cb-q6",                      "type":"BOOLEAN_CHECKBOX",                      "defaultValue":false                   },                   {                        "name":"tvFirst",                      "type":"STRING",                      "description":"Verify engine burn fractures?",                      "minCharacters":10,                      "maxCharacters":100                   },                   {                        "name":"swFirst",                      "tag":"sw-q6",                      "type":"BOOLEAN_SWITCH",                      "defaultValue":false                   }                ]             }          ]       },       {            "title":"Head and Web",          "data":[               {                  "id":"row1",                "elements":[                     {                        "name":"cbFirst",                      "tag":"cb-q7",                      "type":"BOOLEAN_CHECKBOX",                      "defaultValue":false                   },                   {                        "name":"tvFirst",                      "type":"STRING",                      "description":"Verify for head and web separation?",                      "minCharacters":10,                      "maxCharacters":100                   },                   {                        "name":"swFirst",                      "tag":"sw-q7",                      "type":"BOOLEAN_SWITCH",                      "defaultValue":false                   }                ]             }          ]       },       {            "title":"Split Web",          "data":[               {                  "id":"row1",                "elements":[                     {                        "name":"cbFirst",                      "tag":"cb-q8",                      "type":"BOOLEAN_CHECKBOX",                      "defaultValue":false                   },                   {                        "name":"tvFirst",                      "type":"STRING",                      "description":"Verify for lengthwise crack along the side of web?",                      "minCharacters":10,                      "maxCharacters":100                   },                   {                        "name":"swFirst",                      "tag":"sw-q8",                      "type":"BOOLEAN_SWITCH",                      "defaultValue":false                   }                ]             }          ]       },       {            "title":"Broken Base",          "data":[               {                  "id":"row1",                "elements":[                     {                        "name":"cbFirst",                      "tag":"cb-q9",                      "type":"BOOLEAN_CHECKBOX",                      "defaultValue":false                   },                   {                        "name":"tvFirst",                      "type":"STRING",                      "description":"Verify for break in the base of the rail?",                      "minCharacters":10,                      "maxCharacters":100                   },                   {                        "name":"swFirst",                      "tag":"sw-q9",                      "type":"BOOLEAN_SWITCH",                      "defaultValue":false                   }                ]             }          ]       },       {            "title":"Bolt Hole Crack",          "data":[               {                  "id":"row1",                "elements":[                     {                        "name":"cbFirst",                      "tag":"cb-q10",                      "type":"BOOLEAN_CHECKBOX",                      "defaultValue":false                   },                   {                        "name":"tvFirst",                      "type":"STRING",                      "description":"Verify for bolt hole crack?",                      "minCharacters":10,                      "maxCharacters":100                   },                   {                        "name":"swFirst",                      "tag":"sw-q10",                      "type":"BOOLEAN_SWITCH",                      "defaultValue":false                   }                ]             }          ]       },       {            "title":"Flattened Rail",          "data":[               {                  "id":"row1",                "elements":[                     {                        "name":"cbFirst",                      "tag":"cb-q11",                      "type":"BOOLEAN_CHECKBOX",                      "defaultValue":false                   },                   {                        "name":"tvFirst",                      "type":"STRING",                      "description":"Verify for flattened rail?",                      "minCharacters":10,                      "maxCharacters":100                   },                   {                        "name":"swFirst",                      "tag":"sw-q11",                      "type":"BOOLEAN_SWITCH",                      "defaultValue":false                   }                ]             }          ]       }    ],    "defectCodes":[         "Insufficient number of joint bolts",       "loose/worn joint bolts",       "Torch-cut or burned-bolt hole in rail",       "Stock rail/switch point not seated or functioning as intended",       "Loose, worn, or missing switch components",       "Heat kinks",       "Worn or defective frog/frog components"    ] }';
